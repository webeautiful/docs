---
title: '签名ETH TOKEN交易'
description: 'Flutter中如何对ETH TOKEN交易数据进行签名'
---

To implement the `signEthTransaction` function in Flutter, you'll need to use the `web3dart` package for Ethereum transactions and `encrypt` for AES encryption and decryption. Here’s a Flutter equivalent using Dart that will sign an Ethereum transaction with a provided private key.

### Setup

First, add the dependencies in your `pubspec.yaml`:

```yaml
dependencies:
  web3dart: ^2.0.2
  encrypt: ^5.0.0
```

### Dart Implementation

The `signEthTransaction` method below corresponds to your JavaScript code and includes encryption, transaction signing, and serialization. Make sure you have installed the dependencies first.

```dart
import 'dart:convert';
import 'package:web3dart/web3dart.dart';
import 'package:encrypt/encrypt.dart' as encrypt;
import 'package:hex/hex.dart';

String decryptPrivateKey(String encryptedPrivateKey, String password) {
  final key = encrypt.Key.fromUtf8(password.padRight(32, ' '));
  final iv = encrypt.IV.fromLength(16); // Adjust based on your actual IV settings
  final encrypter = encrypt.Encrypter(encrypt.AES(key, mode: encrypt.AESMode.cbc));

  final decrypted = encrypter.decrypt64(encryptedPrivateKey, iv: iv);
  return decrypted;
}

Future<String> signEthTransaction({
  required int nonce,
  required String to,
  required double value,
  required int gasLimit,
  required double gasPrice,
  required String encryptedPrivateKey,
  required String password,
  int chainId = 1, // Mainnet by default, you can change it accordingly
}) async {
  // Decrypt the private key
  final privateKeyHex = decryptPrivateKey(encryptedPrivateKey, password);
  final privateKey = EthPrivateKey.fromHex(privateKeyHex);

  // Create transaction parameters
  final transaction = Transaction(
    nonce: nonce,
    to: EthereumAddress.fromHex(to),
    value: EtherAmount.inWei(BigInt.from(value * 1e18)),
    gasPrice: EtherAmount.inWei(BigInt.from(gasPrice * 1e9)),
    maxGas: gasLimit,
  );

  // Connect to Web3 to sign the transaction
  final web3client = Web3Client('https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID', Client());

  try {
    // Sign transaction with the decrypted private key
    final signedTx = await web3client.signTransaction(
      privateKey,
      transaction,
      chainId: chainId,
    );

    // Return the serialized signed transaction in hex format
    return HEX.encode(signedTx);
  } finally {
    web3client.dispose();
  }
}
```

### Explanation of Parameters

- `nonce`: The transaction nonce.
- `to`: The recipient address.
- `value`: The amount of Ether to send, specified in Wei.
- `gasLimit`: The maximum amount of gas to use for the transaction.
- `gasPrice`: The gas price in Gwei.
- `encryptedPrivateKey`: The AES-encrypted private key.
- `password`: The password for decrypting the private key.
- `chainId`: The chain ID for Ethereum networks (default is 1 for mainnet).

### Usage Example

```dart
void main() async {
  String encryptedPrivateKey = "ENCRYPTED_PRIVATE_KEY";
  String password = "PASSWORD";

  String signedTx = await signEthTransaction(
    nonce: 1,
    to: '0xReceiverAddress',
    value: 0.1,
    gasLimit: 21000,
    gasPrice: 20,
    encryptedPrivateKey: encryptedPrivateKey,
    password: password,
  );

  print("Signed Transaction: $signedTx");
}
```

Replace `"ENCRYPTED_PRIVATE_KEY"` and `"PASSWORD"` with the actual encrypted private key and decryption password. The result will be a signed Ethereum transaction in hex format, ready to broadcast to the Ethereum network.